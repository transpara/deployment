version: "3.9"

services:
  collector_telegraf:
    labels:
      - "Version=${COLLECTOR_TELEGRAF_TAG}"
      - "ID=${TELEGRAF_ID}"
    image: transpara/collector-telegraf:${COLLECTOR_TELEGRAF_TAG}
    volumes:
      - ./telegraf.conf:/etc/telegraf/telegraf.conf:ro
      - /:/hostfs:ro
      - /var/run/docker.sock:/var/run/docker.sock
      - /var/run/utmp:/hostfs/var/run/utmp:ro
    environment:
      - extractor_version=${COLLECTOR_TELEGRAF_TAG}
      - disk_free_min=${DISK_FREE_MIN}
      - HOST_ETC=/hostfs/etc
      - HOST_PROC=/hostfs/proc
      - HOST_SYS=/hostfs/sys
      - HOST_VAR=/hostfs/var
      - HOST_RUN=/hostfs/run
      - HOST_MOUNT_PREFIX=/hostfs

      - ID=${TELEGRAF_ID}
      - VERSION=${COLLECTOR_TELEGRAF_TAG}
      - TSTORE_API_URL=${TSTORE_API_URL}
      - TSTORE_FLUSH_INTERVAL_SECONDS=${TSTORE_FLUSH_INTERVAL_SECONDS}
      - TSTORE_FLUSH_SIZE=${TSTORE_FLUSH_SIZE}
      - OUTPUT_BATCH_SIZE=${OUTPUT_BATCH_SIZE}
      - TSYSTEM_SETTINGS_TIMEOUT=${TSYSTEM_SETTINGS_TIMEOUT}
      - TSYSTEM_HOST=${TSYSTEM_HOST}
      - SOURCE_TZ=${SOURCE_TZ}
      - LOG_ENQUEUING=${LOG_ENQUEUING}

    container_name: ${TELEGRAF_NAME}
    hostname: ${TELEGRAF_NAME}
    restart: unless-stopped

networks:
  default:
    name: transpara
    external: true
